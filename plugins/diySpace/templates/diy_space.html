<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªæ€§åŒ–ä¸»é¡µç¼–è¾‘å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ä»£ç é«˜äº® -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
<div class="max-w-7xl mx-auto px-4 py-8">
    <!-- å¤´éƒ¨ -->
    <header class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800">âœ¨ ä¸ªæ€§åŒ–ä¸»é¡µç¼–è¾‘å™¨</h1>
        <p class="text-gray-600 mt-2">æç¤ºï¼šæ‚¨å¯ä»¥ä½¿ç”¨ä»»æ„ Tailwind CSS ç±»è¿›è¡Œè®¾è®¡</p>
    </header>

    <!-- åŒæ å¸ƒå±€ -->
    <div class="grid md:grid-cols-2 gap-6">
        <!-- ç¼–è¾‘åŒº -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">HTML ä»£ç </label>
                <textarea
                        id="editor"
                        class="w-full h-96 font-mono text-sm p-4 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                        placeholder="åœ¨æ­¤è¾“å…¥æ‚¨çš„ HTML..."
                ></textarea>
            </div>

            <button
                    onclick="saveContent()"
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-lg transition-colors"
            >
                ä¿å­˜æ›´æ–°
            </button>

            <!-- å¿«æ·å·¥å…· -->
            <div class="mt-4 space-y-2">
                <p class="text-sm text-gray-500">å¿«æ·å‘½ä»¤ï¼š</p>
                <div class="flex gap-2">
                    <button onclick="clearAllContent()"
                            class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg">æ¸…ç©ºæ‰€æœ‰
                    </button>
                    <button onclick="insertSnippet('idPicture')" class="text-sm px-3 py-1 bg-gray-100 rounded">å¤´åƒ
                    </button>
                    <button onclick="insertSnippet('userBIO')" class="text-sm px-3 py-1 bg-gray-100 rounded">ç”¨æˆ·åå¡ç‰‡
                    </button>
                    <button onclick="insertSnippet('mailto')" class="text-sm px-3 py-1 bg-gray-100 rounded">é‚®ç®±
                    </button>
                    <button onclick="insertSnippet('card')" class="text-sm px-3 py-1 bg-gray-100 rounded">å¡ç‰‡</button>
                    <button onclick="insertSnippet('button')" class="text-sm px-3 py-1 bg-gray-100 rounded">æŒ‰é’®
                    </button>
                    <button onclick="insertSnippet('grid')" class="text-sm px-3 py-1 bg-gray-100 rounded">ç½‘æ ¼</button>
                </div>
            </div>
        </div>
        <!-- é¢„è§ˆåŒº -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-medium text-gray-700">å®æ—¶é¢„è§ˆ</h3>
                <button
                        onclick="toggleFullscreen()"
                        class="text-indigo-600 hover:text-indigo-700 text-sm"
                >
                    å…¨å±é¢„è§ˆ
                </button>
            </div>
            <div id="preview" class="border rounded-lg p-4 h-[500px] overflow-auto"></div>
        </div>
    </div>

    <!-- ç¤ºä¾‹ä»£ç  -->
    <details class="mt-8 bg-white rounded-lg shadow-md overflow-hidden">
        <summary class="p-4 cursor-pointer font-medium">ğŸ“‹ ç¤ºä¾‹ä»£ç æ¨¡æ¿1ï¼ˆç®€å†ï¼‰</summary>
        <button onclick="useExampleHTML()" class="text-sm px-3 py-1 bg-gray-100 rounded">ä½¿ç”¨</button>
        <pre class="m-0 p-4 bg-gray-50 border-t" style="display: none;"><code class="html" id="example-html">
            æš‚æœªå®ç°</code></pre>
    </details>
</div>

<script>
    // å®æ—¶é¢„è§ˆåŠŸèƒ½
    const editor = document.getElementById('editor');
    const preview = document.getElementById('preview');

    editor.addEventListener('input', () => {
        preview.innerHTML = editor.value;
        hljs.highlightAll();
    });

    // ä¿å­˜åŠŸèƒ½
    async function saveContent() {
        try {
            const response = await fetch('/diy/space', {
                method: 'PUT',
                ContentType: 'application/json',
                body: JSON.stringify({html: editor.value}),
                credentials: 'include'
            });

            if (!response.ok) throw new Error('ä¿å­˜å¤±è´¥');
            alert('ä¿å­˜æˆåŠŸï¼');
        } catch (error) {
            alert(error.message);
        }
    }

    // å¿«æ·æ’å…¥ä»£ç ç‰‡æ®µ
    const snippets = {
        card: `
<div class="bg-white rounded-xl shadow-md p-6 mb-4">
    <h2 class="text-xl font-semibold mb-3">å¡ç‰‡æ ‡é¢˜</h2>
    <p class="text-gray-600">å¡ç‰‡å†…å®¹...</p>
</div>`,
        button: `
<button class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
    æŒ‰é’®æ–‡å­—
</button>`,
        grid: `
<div class="grid md:grid-cols-2 gap-4">
    <div>å·¦ä¾§å†…å®¹</div>
    <div>å³ä¾§å†…å®¹</div>
</div>`,
        idPicture: `
        <img alt="å¤´åƒ" class="w-32 h-32 rounded-full border-4 border-indigo-100 dark:border-gray-600" src="{{ avatar_url }}">
        `,
        mailto: `
        <a href="mailto:{{ profiles[2] }}" class="text-indigo-600 dark:text-indigo-400 hover:underline">{{ profiles[2] }}</a>`,
        userBIO: `
        <div class="bg-white rounded-xl shadow-md p-6 mb-4">
            <h2 class="text-xl font-semibold mb-3">{{ profiles[1] }}</h2>
            <p class="text-gray-600">{{ userBio }}</p>
        </div>`
    };

    function insertSnippet(type) {
        editor.value += snippets[type];
        editor.dispatchEvent(new Event('input'));
    }

    function clearAllContent() {
        if (confirm('ç¡®å®šæ¸…ç©ºç¼–è¾‘å†…å®¹å—ï¼Ÿ')) {
        }
        editor.value = '';
        editor.dispatchEvent(new Event('input'));
    }


    function useExampleHTML() {
        var exampleCode = document.getElementById('example-html').innerText;
        editor.value = '';
        editor.value = exampleCode;
        editor.dispatchEvent(new Event('input'));
    }


    // å…¨å±é¢„è§ˆåˆ‡æ¢ï¼ˆå¢åŠ é®ç½©å±‚ï¼‰
    let isFullscreen = false;
    const closeBtn = document.createElement('button');
    const overlay = document.createElement('div'); // æ–°å¢é®ç½©å±‚

    // å…³é—­æŒ‰é’®é…ç½®
    closeBtn.innerHTML = 'âœ•';
    closeBtn.className = 'fixed top-4 right-4 z-50 p-2 bg-red-500 text-white rounded-full w-10 h-10 flex items-center justify-center shadow-lg bg-red-600 transition-colors cursor-pointer';
    closeBtn.onclick = toggleFullscreen;

    // é®ç½©å±‚é…ç½®
    overlay.className = 'fixed inset-0 bg-black/50 z-40 hidden'; // åŠé€æ˜é»‘è‰²èƒŒæ™¯
    overlay.onclick = toggleFullscreen; // ç‚¹å‡»é®ç½©å±‚ä¹Ÿå¯å…³é—­

    document.body.append(overlay);

    function toggleFullscreen() {
        isFullscreen = !isFullscreen;
        const preview = document.getElementById('preview');

        preview.classList.toggle('fixed', isFullscreen);
        preview.classList.toggle('inset-0', isFullscreen);
        preview.classList.toggle('z-50', isFullscreen);
        preview.classList.toggle('h-screen', isFullscreen);

        if (isFullscreen) {
            overlay.classList.remove('hidden');
            document.body.appendChild(closeBtn);
            document.addEventListener('keydown', handleEsc);
        } else {
            overlay.classList.add('hidden');
            closeBtn.remove();
            document.removeEventListener('keydown', handleEsc);
        }
    }

    // ESC é”®å¤„ç†
    function handleEsc(event) {
        if (event.keyCode === 27 && isFullscreen) { // 27 æ˜¯ ESC é”®
            toggleFullscreen();
        }
    }
</script>
</body>
</html>